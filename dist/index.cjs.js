"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const t={targetWidth:160,container:document.body,html:"",css:"",data:{}},e="content-change",n="img-click",i="error",r="Container must be a valid DOM element",s="HTML content must be a string",a="Styles must be a string",o="Data must be an object",d="Target width must be a positive number",h="Card has been destroyed and cannot perform operations",l=[];for(let t=0;t<256;++t)l.push((t+256).toString(16).slice(1));let c;const p=new Uint8Array(16);var g={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function u(t,e,n){const i=(t=t||{}).random??t.rng?.()??function(){if(!c){if("undefined"==typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");c=crypto.getRandomValues.bind(crypto)}return c(p)}();if(i.length<16)throw new Error("Random bytes length must be >= 16");return i[6]=15&i[6]|64,i[8]=63&i[8]|128,function(t,e=0){return(l[t[e+0]]+l[t[e+1]]+l[t[e+2]]+l[t[e+3]]+"-"+l[t[e+4]]+l[t[e+5]]+"-"+l[t[e+6]]+l[t[e+7]]+"-"+l[t[e+8]]+l[t[e+9]]+"-"+l[t[e+10]]+l[t[e+11]]+l[t[e+12]]+l[t[e+13]]+l[t[e+14]]+l[t[e+15]]).toLowerCase()}(i)}function m(){return`shadow-card-${g.randomUUID&&!t?g.randomUUID():u(t)}`;var t}const y={validateContainer(t){if(!(t instanceof HTMLElement))throw new Error(r)},validateHtml(t){if("string"!=typeof t)throw new Error(s)},validateCss(t){if("string"!=typeof t)throw new Error(a)},validateData(t){if(null!==t&&"object"!=typeof t)throw new Error(o)},validateTargetWidth(t){if("number"!=typeof t||t<=0||isNaN(t))throw new Error(d)},validateNotDestroyed(t){if(t.isDestroyed)throw new Error(h)}};class v{constructor(e={}){try{this.options={...t,...e},y.validateContainer(this.options.container),y.validateHtml(this.options.html),y.validateCss(this.options.css),y.validateData(this.options.data),y.validateTargetWidth(this.options.targetWidth),this.id=m(),this.isDestroyed=!1,this.data={...this.options.data},this.eventListeners=new Map,this.resizeTimer=null,this.element=this.createHostElement(),this.shadow=this.element.shadowRoot,this.innerContainer=this.shadow.getElementById("inner-container"),this.setHTML(this.options.html),this.setStyle(this.options.css),this.setContent(this.options.data),this.options.container.appendChild(this.element),this.resizeTimer=setTimeout(async()=>{await this.resize()},0)}catch(t){throw this.dispatchError(t.message),t}}waitForImages(){return new Promise(t=>{const e=Array.from(this.shadow.querySelectorAll("img"));if(0===e.length)return void t();let n=0;const i=()=>{n++,n===e.length&&t()};e.forEach(t=>{t.complete?i():(t.addEventListener("load",i,{once:!0}),t.addEventListener("error",i,{once:!0}))})})}createHostElement(){const t=document.createElement("shadow-card");t.id=this.id,t.dataset.id=this.id,this.applyStyleVariables(t);const e=t.attachShadow({mode:"open"});return e.innerHTML=`\n        <style>\n        :host {\n            all: initial;\n            display: block;\n            border: var(--shadow-card-border, 2px solid var(--shadow-card-border-color));\n            border-radius: var(--shadow-card-border-radius, 6px);\n            cursor: pointer;\n            overflow: hidden;\n            box-sizing: border-box;\n            transition: border 0.3s ease;\n            user-select: none;\n            position: relative;\n            margin: ${this.options?.styles?.marginHeight||"8px"} ${this.options?.styles?.marginWitdh||"auto"};\n        }\n        \n        :host(:hover) {\n            border-color: var(--shadow-card-hover-border-color, #3b82f6);\n        }\n        \n        #inner-container {\n            // width: 100%;\n            width:640px;\n            transform-origin: top left;\n            transform: scale(1);\n            display: flex;\n            align-items: center;\n            justify-content: center;\n        }\n\n        #loading-overlay {\n            position: absolute;\n            inset: 0;\n            background: var(--shadow-card-loading-bg, #ffffff);\n            color: var(--shadow-card-loading-color, #4b5563);\n            font-size: var(--shadow-card-loading-font-size, 0.8rem);\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            gap: var(--shadow-card-loading-gap, 8px);\n            z-index: 10;\n            opacity: 1;\n            transition: opacity 0.3s ease;\n        }\n        \n        .loading-spinner {\n            width: var(--shadow-card-loading-icon-size, 20px);\n            height: var(--shadow-card-loading-icon-size, 20px);\n            border: 2px solid var(--shadow-card-loading-spinner-border, rgba(0, 0, 0, 0.1));\n            border-top-color: var(--shadow-card-loading-spinner-color, #3b82f6);\n            border-radius: 50%;\n            animation: spin var(--shadow-card-loading-spinner-speed, 1s) linear infinite;\n        }\n        \n        @keyframes spin {\n            to { transform: rotate(360deg); }\n        }\n        \n        #loading-overlay.hidden {\n            opacity: 0;\n            pointer-events: none;\n        }\n        </style>\n        <div id="loading-overlay">\n            <div class="loading-spinner"></div>\n            <span class="loading-text">${this.options?.styles?.loadingText||"Loading..."}</span>\n        </div>\n        <div id="inner-container"></div>\n    `,this.boundInputHandler=t=>this.handleInput(t),this.boundClickHandler=t=>this.handleClick(t),e.addEventListener("input",this.boundInputHandler),e.addEventListener("click",this.boundClickHandler),this.boundPasteHandler=t=>this.handlePaste(t),e.addEventListener("paste",this.boundPasteHandler),t}handlePaste(t){if(t.target?.isContentEditable&&!t.defaultPrevented){t.preventDefault();try{const e=t.clipboardData||window.clipboardData;if(!e)throw new Error("Clipboard access unavailable");const n=e.getData("text")||"";if(""===n.trim())return;const i=window.getSelection();if(!i||0===i.rangeCount)return void(t.target.textContent+=n);const r=i.getRangeAt(0);r.deleteContents();const s=document.createTextNode(n);r.insertNode(s),r.setStartAfter(s),r.setEndAfter(s),i.removeAllRanges(),i.addRange(r)}catch(e){console.warn("Plain text paste enforcement failed:",e),t.target.textContent+=(t.clipboardData||window.clipboardData)?.getData("text")||""}}}applyStyleVariables(t){if(t&&t instanceof HTMLElement)try{const e=this.getStyleMappings();this.options?.styles&&"object"==typeof this.options.styles&&Object.entries(e).forEach(([e,n])=>{if(void 0!==this.options.styles[e])try{t.style.setProperty(n,this.options.styles[e])}catch(t){console.error(`Failed to set CSS variable ${n}:`,t)}})}catch(t){console.error("Error in applyStyleVariables:",t)}else console.error("Invalid element passed to applyStyleVariables. Must be an HTMLElement.")}getStyleMappings(){return{border:"--shadow-card-border",borderColor:"--shadow-card-border-color",borderRadius:"--shadow-card-border-radius",hoverBorderColor:"--shadow-card-hover-border-color",loadingBg:"--shadow-card-loading-bg",loadingColor:"--shadow-card-loading-color",loadingFontSize:"--shadow-card-loading-font-size",loadingGap:"--shadow-card-loading-gap",loadingIconSize:"--shadow-card-loading-icon-size",loadingSpinnerBorder:"--shadow-card-loading-spinner-border",loadingSpinnerColor:"--shadow-card-loading-spinner-color",loadingSpinnerSpeed:"--shadow-card-loading-spinner-speed",loadingText:"--shadow-card-loading-text"}}setCssVariables(t){try{if(y.validateNotDestroyed(this),"object"!=typeof t||null===t)throw new Error("Style variables must be a valid object");const e=this.getStyleMappings();if(Object.entries(t).forEach(([t,n])=>{const i=e[t];i&&void 0!==n&&this.element.style.setProperty(i,n)}),t.loadingText){const e=this.shadow.querySelector(".loading-text");e&&(e.textContent=t.loadingText)}return this}catch(t){return this.dispatchError(t.message),this}}handleInput(t){if(this.isDestroyed)return;const n=t.target;if(n.isContentEditable&&n.hasAttribute("data-field"))try{const t=n.getAttribute("data-field"),i=n.innerText;this.data[t]=i,this.dispatchEvent(e,{field:t,value:i})}catch(t){this.dispatchError(t.message)}}handleClick(t){if(this.isDestroyed)return;const e=t.target;if("IMG"===e.tagName&&e.hasAttribute("data-img"))try{this.dispatchEvent(n,{imgKey:e.getAttribute("data-img"),element:e})}catch(t){this.dispatchError(t.message)}}dispatchEvent(t,e){this.isDestroyed||this.element.dispatchEvent(new CustomEvent(t,{detail:{...e,cardId:this.id},bubbles:!0,cancelable:!0}))}dispatchError(t){this.dispatchEvent(i,{message:t})}async setHTML(t){try{return y.validateNotDestroyed(this),y.validateHtml(t),this.innerContainer.innerHTML=t,this.innerContainer.offsetHeight,await this.resize(),this}catch(t){return this.dispatchError(t.message),this}}setStyle(t,e=!1){try{y.validateNotDestroyed(this),y.validateCss(t);let n=this.shadow.querySelector("#custom-style");return n||(n=document.createElement("style"),n.id="custom-style",this.shadow.insertBefore(n,this.innerContainer)),n.textContent=e?t:`${n.textContent}\n${t}`,this}catch(t){return this.dispatchError(t.message),this}}setContent(t){try{return y.validateNotDestroyed(this),y.validateData(t),this.data={...this.data,...t},Object.entries(t).forEach(([t,e])=>{const n=this.shadow.querySelector(`[data-field="${t}"]`);n?.isContentEditable&&(n.innerText=null==e?"":String(e))}),this}catch(t){return this.dispatchError(t.message),this}}async resize(t){try{y.validateNotDestroyed(this);const e=this.shadow.querySelector("#loading-overlay");e.classList.remove("hidden"),void 0!==t&&(y.validateTargetWidth(t),this.options.targetWidth=t),this.element.style.width=`${this.options.targetWidth}px`,this.element.style.height="auto",await this.waitForImages();const n=this.innerContainer.offsetWidth;0===n&&(this.innerContainer.style.minWidth="1px",this.innerContainer.style.minHeight="1px",n=Math.max(1,this.innerContainer.offsetWidth));const i=Math.min(1,this.options.targetWidth/n);this.innerContainer.style.transform=`scale(${i})`,this.innerContainer.style.transformOrigin="top left";const r=Math.max(1,this.innerContainer.offsetHeight*i);return this.element.style.height=`${r}px`,this.innerContainer.style.width=this.options.targetWidth/i+"px",this.innerContainer.style.overflow="hidden",requestAnimationFrame(()=>{e.classList.add("hidden")}),this}catch(t){return this.dispatchError(t.message),this.shadow?.querySelector("#loading-overlay")?.classList.add("hidden"),this}}on(t,e){return this.isDestroyed?this:"function"!=typeof e?(this.dispatchError("Event handler must be a function"),this):(this.eventListeners.has(t)||this.eventListeners.set(t,new Set),this.eventListeners.get(t).add(e),this.element.addEventListener(t,e),this)}off(t,e){if(this.isDestroyed)return this;const n=this.eventListeners.get(t);return n?(e?(n.delete(e),this.element.removeEventListener(t,e)):(n.forEach(e=>this.element.removeEventListener(t,e)),n.clear()),this):this}destroy(){this.isDestroyed||(clearTimeout(this.resizeTimer),this.eventListeners.forEach((t,e)=>{t.forEach(t=>this.element.removeEventListener(e,t))}),this.eventListeners.clear(),this.shadow?.removeEventListener("input",this.boundInputHandler),this.shadow?.removeEventListener("click",this.boundClickHandler),this.shadow?.removeEventListener("paste",this.boundPasteHandler),this.element?.parentNode?.removeChild(this.element),this.isDestroyed=!0,this.element=null,this.shadow=null,this.innerContainer=null,this.data=null,this.options=null)}static batchCreate(t){if(!Array.isArray(t))throw new Error("batchCreate requires an array of card configurations");return t.map(t=>new v(t))}}exports.ShadowCard=v,exports.default=v;
//# sourceMappingURL=index.cjs.js.map
